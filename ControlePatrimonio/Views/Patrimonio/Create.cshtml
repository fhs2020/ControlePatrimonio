@model ControlePatrimonio.Models.Patrimonio

@{
    ViewBag.Title = "Create";
}

<h2>Adicionar item</h2>


@using (Html.BeginForm("Create", "Patrimonio", FormMethod.Post,
                                                                   new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()

    <input type="hidden" id="refresh" value="no">

    <div class="form-horizontal">
        <h4>Patrimonio</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="row">

            <div class="form-group">
                @Html.LabelFor(model => model.EmpresaId, "Empresa", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.DropDownListFor(model => model.EmpresaId, (SelectList)ViewBag.EmpresaLista, "Selecione uma empresa", new { @class = "form-control", required = "required" })
                    @Html.ValidationMessageFor(model => model.EmpresaId, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.FilialId, "Filial", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.DropDownListFor(model => model.FilialId, (SelectList)ViewBag.Filial, "Selecione uma filial", new { @class = "form-control" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.FornecedorId, "Fornecedor", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.DropDownListFor(model => model.FornecedorId, (SelectList)ViewBag.FornecedoresLista, "selecione um fornecedor", new { @class = "form-control", required = "required" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.ProdutoId, "Categoria", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.DropDownList("CategoriaID", (SelectList)ViewBag.Categoria, "selecione uma categoria", new { @class = "form-control", required = "required" })
                </div>
            </div>


            <div class="form-group">
                @Html.LabelFor(model => model.ProdutoId, "Produto - Marca - Modelo", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.DropDownListFor(model => model.ProdutoId, (SelectList)ViewBag.ProdutosLista, "selecione um produto", new { @class = "form-control", required = "required" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.DataAquisicao, "Data Aquisição", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.DataAquisicao, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.DataAquisicao, "", new { @class = "text-danger" })
                </div>
            </div>

            @*<div class="form-group">
                    @Html.LabelFor(model => model.DataAquisicao, "Data Aquisição", htmlAttributes: new { @class = "control-label col-md-4" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.DataAquisicao, new { htmlAttributes = new { @class = "form-control" } })
                    </div>
                </div>*@

            <div class="form-group">
                @Html.LabelFor(model => model.Descricao, "Descrição", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.Descricao, new { htmlAttributes = new { @class = "form-control" } })
                </div>
            </div>

            @*<div class="form-group">
                    @Html.LabelFor(model => model.Valor, htmlAttributes: new { @class = "control-label col-md-4" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.Valor, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.Valor, "", new { @class = "text-danger" })
                    </div>
                </div>*@

            @*<div class="form-group">
                    @Html.LabelFor(model => model.NotaFiscal, "Nota Fiscal", htmlAttributes: new { @class = "control-label col-md-4" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.NotaFiscal, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.NotaFiscal, "", new { @class = "text-danger" })
                    </div>
                </div>*@

            <div class="form-group">
                @Html.LabelFor(model => model.NotaFiscal, "Número de nota fiscal", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.NotaFiscal, new { htmlAttributes = new { @class = "form-control" } })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.NumeroSerie, "Número de serie", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.NumeroSerie, new { htmlAttributes = new { @class = "form-control" } })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.NumeroPatrimonio, "N° patrimonio", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.NumeroPatrimonio, new { htmlAttributes = new { @class = "form-control", required = "required" } })
                    @Html.ValidationMessageFor(model => model.NumeroPatrimonio, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.TempoGarantia, "Tempo Garantia em meses", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.TempoGarantia, new { htmlAttributes = new { @class = "form-control" } })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.Licensa, "Licença", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.Licensa, new { htmlAttributes = new { @class = "form-control" } })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.Observacao, "Observação", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.TextAreaFor(model => model.Observacao, new { @class = "form-control" })
                </div>
            </div>

            @*<div class="form-group">
                    @Html.LabelFor(model => model.URLImage, "Imagem", htmlAttributes: new { @class = "control-label col-md-4" })
                    <div class="col-md-10">
                        <input type="file" name="fileImage" class="form-control"/><br><br>
                        <br><br>
                        @ViewBag.Message
                    </div>
                </div>*@


            <div class="form-group">
                <div class="col-md-offset-2 col-md-12">
                    <input type="submit" value="Adicionar" class="btn btn-success btn-lg" />
                </div>
            </div>




        </div>

    </div>
}

<div>
    @Html.ActionLink("Voltar para lista de Patrimonio", "Index")
</div>

@section Scripts {
    <script src="~/Scripts/jquery-1.10.2.js"></script>
    <script src="~/Scripts/inputmask/jquery.inputmask.js"></script>
    @Scripts.Render("~/bundles/jqueryval")
    

    <script language="javascript" type="text/javascript">
        $(document).ready(function () {
            $("#DataAquisicao").inputmask("mask", { "mask": "99/99/9999" });

            debugger;
            var input = $('#refresh').val();
            //input == 'yes' ? window.location = "/Patrimonio/Create" : input = 'yes';

            if (input == "no") {
                $('#refresh').val("yes");
            }
            else {
                $('#refresh').val("no"); location.reload(true);
            }
        });

        $("#DataAquisicao").focusout(function () {
            var data = $("#DataAquisicao").val();
            var date = new Date(data.split('/').reverse().join('/'));

            var dataHoje = new Date();
            var today = dataHoje.getFullYear();
            var year = date.getFullYear();

            if (year < 2000 || year > today) {

                alert("Data Aquisição invalida!");
            }
        });


        $('#CategoriaID').change(function () {

            var url = "/Patrimonio/GetProdutoByCategoriaID/";
            var categoriaId = $('#CategoriaID').val();

            $.ajax({
                url: url,
                data: { categoriaId: categoriaId },
                cache: false,
                type: "POST",
                success: function (data) {
                    var markup = "<option value='0'>Selecione produto</option>";
                    for (var x = 0; x < data.length; x++) {
                        markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                    }
                    $("#ProdutoId").html(markup).show();
                },
                error: function (reponse) {
                    alert("error : " + reponse);
                }
            });

        });


        $('#EmpresaId').change(function () {

            var url = "/Patrimonio/GetFilialByEmpresaID/";
            var empresaId = $('#EmpresaId').val();

            $.ajax({
                url: url,
                data: { empresaId: empresaId },
                cache: false,
                type: "POST",
                success: function (data) {
                    var markup = "<option value='0'>Selecione Filial</option>";
                    for (var x = 0; x < data.length; x++) {
                        markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                    }
                    $("#FilialId").html(markup).show();
                },
                error: function (reponse) {
                    alert("error : " + reponse);
                }
            });

        });

    </script>


}

