@model ControlePatrimonio.Models.Patrimonio

@{
    ViewBag.Title = "Edit";


    //if (Model.URLImage == null)
    //{
    //    Model.URLImage = "Hello";
    //}


    //var img = new FileInfo(Model.URLImage);
}

<h2>Editar</h2>


@using (Html.BeginForm("Edit", "Patrimonio", FormMethod.Post,
                                           new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    @*@Html.HiddenFor(model => model.URLImage)*@
    
    <div class="form-horizontal">
        <h4>Patrimonio</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.Id)
        @Html.HiddenFor(model => model.DataCadastro)

        <div class="form-group">
            @Html.LabelFor(model => model.EmpresaId, "Empresa", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownListFor(model => model.EmpresaId, (SelectList)ViewBag.Empresa, new { @class = "form-control", required = "required" })
                @Html.ValidationMessageFor(model => model.EmpresaId, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.FilialId, "Filial", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownListFor(model => model.FilialId, (SelectList)ViewBag.FilialLista, new { @class = "form-control" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.FornecedorId, "Fornecedor", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownListFor(model => model.FornecedorId, (SelectList)ViewBag.FornecedoresLista, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.FornecedorId, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.ProdutoId, "Categoria", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownList("CategoriaID", (SelectList)ViewBag.Categoria, "selecione uma categoria", new { @class = "form-control" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.ProdutoId, "Produto - Marca - Modelo", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownListFor(model => model.ProdutoId, (SelectList)ViewBag.ProdutosLista, new { @class = "form-control" })
            </div>
        </div>

        @*<div class="form-group">
            @Html.LabelFor(model => model.DataAquisicao, "Data aquisição", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.DataAquisicao, "{0:dd/MM/yyyy}", new { htmlAttributes = new { @class = "form-control" } })
            </div>
        </div>*@

        <div class="form-group">
            @Html.LabelFor(model => model.Descricao, "Descrição", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Descricao, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Descricao, "", new { @class = "text-danger" })
            </div>
        </div>

        @*<div class="form-group">
            @Html.LabelFor(model => model.Valor, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Valor, new { htmlAttributes = new { @class = "form-control", @data_val = "false" } })
                @Html.ValidationMessageFor(model => model.Valor, "", new { @class = "text-danger" })
            </div>
        </div>*@

        @*<div class="form-group">
            @Html.LabelFor(model => model.NotaFiscal, "Nota Fiscal", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.NotaFiscal, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.NotaFiscal, "", new { @class = "text-danger" })
            </div>
        </div>*@

        <div class="form-group">
            @Html.LabelFor(model => model.NumeroSerie, "N° Serie", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.NumeroSerie, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.NumeroSerie, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.NumeroPatrimonio, "N° Patrimonio", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.NumeroPatrimonio, new { htmlAttributes = new { @class = "form-control", required = "required" } })
                @Html.ValidationMessageFor(model => model.NumeroPatrimonio, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.TempoGarantia, "Tempo Garantia", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.TempoGarantia, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.TempoGarantia, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Licensa, "Licença", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Licensa, new { htmlAttributes = new { @class = "form-control" } })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Observacao, "Observação", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.TextAreaFor(model => model.Observacao, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.Observacao, "", new { @class = "text-danger" })
            </div>
        </div>

        @*<div class="form-group">
            @Html.LabelFor(model => model.URLImage, "Nova Imagem", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <input type="file" name="fileImage" class="form-control" /><br><br>
                <br><br>
            </div>
        </div>*@


        @*@if (img.Name != "Hello")
        {
            <div class="form-group">
                @Html.LabelFor(model => model.URLImage, "Imagem", htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col" style="width: 500px;">
                    <img src="@Url.Content(String.Format("~/Content/Images/{0}", img.Name))" />
                </div>
            </div>
        }*@


        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Salvar" class="btn btn-success btn-lg" />
            </div>
        </div>

    </div>
}

<div>
    @Html.ActionLink("Voltar para lista de items / Patrimonios", "Index")
</div>



@section Scripts {

    @Scripts.Render("~/bundles/jqueryval")


    <script language="javascript" type="text/javascript">


            $('#CategoriaID').mouseleave(function () {
                var procemessage = "<option value='0'> Please wait...</option>";
                $("#ProduId").html(procemessage).show();
                var url = "/Patrimonio/GetProdutoByCategoriaID/";
                var categoriaId = $('#CategoriaID').val();

                $.ajax({
                    url: url,
                    data: { categoriaId: categoriaId },
                    cache: false,
                    type: "POST",
                    success: function (data) {
                        var markup = "<option value='0'>Selecione produto</option>";
                        for (var x = 0; x < data.length; x++) {
                            markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                        }
                        $("#ProdutoId").html(markup).show();
                    },
                    error: function (reponse) {
                        alert("error : " + reponse);
                    }
                });

        });

        $('#EmpresaId').change(function () {

            var procemessage = "<option value='0'> Please wait...</option>";
            
            var url = "/Patrimonio/GetFilialByEmpresaID/";
            var empresaId = $('#EmpresaId').val();
            debugger;
            $.ajax({
                url: url,
                data: { empresaId: empresaId },
                cache: false,
                type: "POST",
                success: function (data) {
                    var markup = "<option value='0'>Selecione Filial</option>";
                    for (var x = 0; x < data.length; x++) {
                        markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                    }
                    $("#FilialId").html(markup).show();
                },
                error: function (reponse) {
                    alert("error : " + reponse);
                }
            });

        });


    </script>


}